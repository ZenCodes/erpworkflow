

<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../chemical-property-card/chemical-property-card.html">
<link rel="import" href="../mechanical-property-card/mechanical-property-card.html">

<link rel="import" href="../mechanical-property-itemcard/mechanical-property-itemcard.html">
<link rel="import" href="../chemical-property-itemcard/chemical-property-itemcard.html">
<link rel="import" href="../mechanic-property-displaycard/mechanic-property-displaycard.html">
<link rel="import" href="../chemic-property-displaycard/chemic-property-displaycard.html">
<dom-module id="internalintentview-expandpage">
  <template>
    <style>
      :host {
        display: block;
      }
      .chemic,.mechanic {
        padding: 10px 15px;
        margin-top: 20px;
        /*background-color: #f3f3f3;*/
        border:  1px solid #dedede;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
        font-size: 18px;
        cursor: pointer;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        width: 100%;
        text-align: left;
        margin-left: 5%;

      }

      .content {
        padding: 15px;
        width: 50%;
        margin-left: 10%;
        /*border: 1px solid #dedede;*/
        /*border-top: none;*/
        /*border-bottom-left-radius: 5px;*/
        /*border-bottom-right-raius: 5px;*/
        /*@apply(--shadow-elevation-2dp);*/
      }
      paper-input{
        margin-top: -5%;
      }
      paper-button{
        text-align: center;
        width: 30%;
        background-color: #A0A0A0;
        font-family: calibri;
        font-size: 17px;
        color: black;
        height: 35px;
        margin-top: 4%;
        text-transform: none;
      }
      button{
       font-family: calibri;
        font-size: 20px; 
      }
      .btncard{
        margin-left: 10%;
      }
    </style>
    <div>
    <button class="chemic" on-click="FnExpandChemic">Chemical Test</button>
    <iron-collapse id="collapse1">
      <div class="content">
         <div>
          <chemical-property-card id="chemicproperty" chemicalArray="{{chemicalArray}}" itemid="{{itemid}}" itemdes="{{itemdes}}" lotno="{{lotno}}" batchno="{{batchno}}" intentregno="{{intentregno}}" containerid="{{containerid}}"></chemical-property-card>
          <chemic-property-displaycard carray="{{carray}}"></chemic-property-displaycard>
        </div>
      </div>
    </iron-collapse>

    <button class="mechanic" on-click="FnExpandMechanic">Mechanical Test</button>
    <iron-collapse id="collapse2">
      <div class="content">
        <div>
          <mechanical-property-card id="mechanicproperty" mechanicalArray="{{mechanicalArray}}" itemid="{{itemid}}" itemdes="{{itemdes}}" lotno="{{lotno}}" batchno="{{batchno}}" intentregno="{{intentregno}}" containerid="{{containerid}}"></mechanical-property-card>
          <mechanic-property-displaycard marray="{{marray}}"></mechanic-property-displaycard>
        </div>
      </div>
    </iron-collapse>

    <!-- Component which make request to read the chemical parameters for the item -->
    <iron-ajax
      method="post"
      id="chemicalpropertyreadajax"
      url="{{chemicalpropertyreadurl}}"
      params="{{chemicalpropertyreadparam}}"
      handle-as="json"
      content-type="application/json"
      on-response="chemicalpropertyreadResponse">
    </iron-ajax>

    <!-- Component which make request to read the mechanical parameters for the item -->
    <iron-ajax
      method="post"
      id="mechanicalpropertyreadajax"
      url="{{mechanicalpropertyreadurl}}"
      params="{{mechanicalpropertyreadparam}}"
      handle-as="json"
      content-type="application/json"
      on-response="mechanicalpropertyreadResponse">
    </iron-ajax>
    <!-- Component which make request to read the chemical parameters value for the item -->
    <iron-ajax
      method="post"
      id="chemicalpropertydisplayreadajax"
      url="{{chemicalpropertydisplayreadurl}}"
      params="{{chemicalpropertydisplayreadparam}}"
      handle-as="json"
      content-type="application/json"
      on-response="chemicalpropertydisplayreadResponse">
    </iron-ajax>

    <!-- Component which make request to read the mechanical parameters value for the item -->
    <iron-ajax
      method="post"
      id="mechanicalpropertydisplayreadajax"
      url="{{mechanicalpropertydisplayreadurl}}"
      params="{{mechanicalpropertydisplayreadparam}}"
      handle-as="json"
      content-type="application/json"
      on-response="mechanicalpropertydisplayreadResponse">
    </iron-ajax>
    <!-- Component to call the service -->
    <grn-service id="grnservice"></grn-service>

    </div>
  </template>
  <script>
  (function() {
    'use strict';
    var chemicarr=[];
    var mechanicarr=[];
    Polymer({
      is: 'internalintentview-expandpage',
      ready:function(){
        this.temparr=[];
        var obj={"Property_Name":"","actualval":"","remark":""};
        this.temparr.push(obj);
        this.chemicalArray=this.temparr;
        this.mechanicalArray=this.temparr;
        // alert(JSON.stringify((this.itemArray).length));
      },
      FnExpandChemic:function(){
        this.FnchemicalpropertydisplayreadService();
        this.$.chemicproperty.FnchemicalpropertyreadService();
        this.$.collapse1.toggle();       
      },
      FnExpandMechanic:function(){
        this.FnmechanicalpropertydisplayreadService();
        this.$.mechanicproperty.FnmechanicalpropertyreadService();
        this.$.collapse2.toggle();
      },
      FnchemicalpropertyreadService:function(){
        var obj={"batchno":""};
        obj.batchno=sessionStorage.getItem("sess_curr_batchno");
        this.chemicalpropertyreadparam=obj;
        this.chemicalpropertyreadurl=sessionStorage.getItem("curr_sess_url")+"chemicalpropertyread-service";
        this.$.chemicalpropertyreadajax.generateRequest();
      },
      chemicalpropertyreadResponse:function(e){        
        this.chemicalArray=e.detail.response;
        // alert(JSON.stringify(this.chemicalArray));
      },
      FnmechanicalpropertyreadService:function(){
        var obj={"batchno":""};
        obj.batchno=sessionStorage.getItem("sess_curr_batchno");
        this.mechanicalpropertyreadparam=obj;
        this.mechanicalpropertyreadurl=sessionStorage.getItem("curr_sess_url")+"mechanicalpropertyread-service";
        this.$.mechanicalpropertyreadajax.generateRequest();
      },
      mechanicalpropertyreadResponse:function(e){        
        this.mechanicalArray=e.detail.response;
        // alert(JSON.stringify(this.mechanicalArray));
      },
      FnSetChemicarr:function(chemicarray){
        
        chemicarr=chemicarray;
      },
      FnSetMechanicarr:function(mechanicarray){
        
        mechanicarr=mechanicarray;
      },
      FnSubmitChemictest:function(){
        // alert(JSON.stringify(chemicarr));
        // alert((chemicarr).length+" "+(this.chemicalArray).length);
         if((chemicarr).length==(this.chemicalArray).length)
        {
          alert('Test submit!');
          this.$.grnservice.FncallinsertchemicalService(chemicarr);
          // this.speccardhide=true;
          // this.hidesubmit=true;
          // this.hidetest=false;
        }
        else{
          alert('Please enter all the quality parameters!');
        }
        
      },
      FnAddChemictest:function(){
      },
      FnSubmitMechanictest:function(){
        // alert(JSON.stringify(mechanicarr));
        // this.$.grnservice.FncallinsertmechanicalService(mechanicarr);
         if((mechanicarr).length==(this.mechanicalArray).length)
        {
          alert('Test submit!');
          this.$.grnservice.FncallinsertmechanicalService(mechanicarr);
          // this.speccardhide=true;
          // this.hidesubmit=true;
          // this.hidetest=false;
        }
        else{
          alert('Please enter all the quality parameters!');
        }
      },
      FnAddMechanictest:function(){
      },
      FnToggleChemic:function(){
        this.$.collapse1.opened=true;
      },
       FnToggleMechanic:function(){
        // alert('toggle'+this.$.collapse2);
        this.$.collapse2.opened=true;
      },
      FnchemicalpropertydisplayreadService:function(){
        var obj={"batchno":""};
        obj.batchno=this.batchno;
        obj.itemid=this.itemid;
        obj.lotno=this.lotno;
        obj.intentregno=this.intentregno;
        obj.containerid=this.containerid;
        this.chemicalpropertydisplayreadparam=obj;
        this.chemicalpropertydisplayreadurl=sessionStorage.getItem("curr_sess_url")+"chemicalpropertydisplayread-service";
        this.$.chemicalpropertydisplayreadajax.generateRequest();
      },
      chemicalpropertydisplayreadResponse:function(e){        
        var arr=e.detail.response;
         if(arr!="no rows") {
          var temparr = [];
          var finalarr = [];
          var flag = "true";
          var testdate="";
          for (var i = 0; i < arr.length; i++) {
            if (flag == "true") {
              temparr.push(arr[i]);
              flag = arr[i].Test_ID;
              testdate = arr[i].Test_Date;
            }
            else {
              if (flag == arr[i].Test_ID) {
                temparr.push(arr[i]);
                flag = arr[i].Test_ID;
                testdate = arr[i].Test_Date;
              }
              else {
                finalarr.push({"testno": flag,"testdate" :testdate, "temparr": temparr});
                temparr = [];
                temparr.push(arr[i]);
                flag = arr[i].Test_ID;
                testdate = arr[i].Test_Date;
              }
            }
          }
          finalarr.push({"testno": flag,"testdate" :testdate, "temparr": temparr});
          // alert(JSON.stringify(finalarr));
          if (finalarr.length > 0) {
            this.carray = finalarr;
          //   document.querySelector('physicqualifyitem-card').Fnhidequality("false");
          }
          // else{
          //   document.querySelector('physicqualifyitem-card').Fnhidequality("true");
          // }
        }
        // alert(JSON.stringify(this.carray));
      },
      FnmechanicalpropertydisplayreadService:function(){
        var obj={"batchno":""};
        obj.batchno=this.batchno;
        obj.itemid=this.itemid;
        obj.lotno=this.lotno;
        obj.intentregno=this.intentregno;
        obj.containerid=this.containerid;
        this.mechanicalpropertydisplayreadparam=obj;
        this.mechanicalpropertydisplayreadurl=sessionStorage.getItem("curr_sess_url")+"mechanicalpropertydisplayread-service";
        this.$.mechanicalpropertydisplayreadajax.generateRequest();
      },
      mechanicalpropertydisplayreadResponse:function(e){        
        var arr=e.detail.response;
         if(arr!="no rows") {
          var temparr = [];
          var finalarr = [];
          var flag = "true";
          var testdate="";
          for (var i = 0; i < arr.length; i++) {
            if (flag == "true") {
              temparr.push(arr[i]);
              flag = arr[i].Test_ID;
              testdate = arr[i].Test_Date;
            }
            else {
              if (flag == arr[i].Test_ID) {
                temparr.push(arr[i]);
                flag = arr[i].Test_ID;
                testdate = arr[i].Test_Date;
              }
              else {
                finalarr.push({"testno": flag,"testdate" :testdate, "temparr": temparr});
                temparr = [];
                temparr.push(arr[i]);
                flag = arr[i].Test_ID;
                testdate = arr[i].Test_Date;
              }
            }
          }
          finalarr.push({"testno": flag,"testdate" :testdate, "temparr": temparr});
          // alert(JSON.stringify(finalarr));
          if (finalarr.length > 0) {
            this.marray = finalarr;
          //   document.querySelector('physicqualifyitem-card').Fnhidequality("false");
          }
          // else{
          //   document.querySelector('physicqualifyitem-card').Fnhidequality("true");
          // }
        }
        // alert(JSON.stringify(this.carray));
      }

    });
  })();
  </script>
</dom-module>
