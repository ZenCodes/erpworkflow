
<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../specification-item-crd/specification-item-crd.html">
<link rel="import" href="../grn-service/grn-service.html">

<dom-module id="specification-card">
  <template>
    <style>
      .outcard{
        @apply(--layout-verical);
        margin-left: 6%;
      }
      #id{
        margin-left: 20%;
      }
      #number{
        margin-left: 10%;
      }
      #test,#submittest{
        /*margin-left: 75%;*/
        text-transform: none;
        text-align: center;
        background-color: #A0A0A0;
        font-family: calibri;
        font-size: 17px;
        color: black;
        height: 35px;
        }
      paper-button{
        text-transform: none;
      }
      paper-tabs{
        width: 70%;
      }
      .btncard{
        margin-left: -80%;
        margin-top: 2%;
      }
    </style>
      <div class="outcard">
        <div class="speccard" hidden$="{{speccardhide}}">
        <paper-tabs selected="0" no-ink no-bar no-slide id="ptab">
          <paper-tab><paper-button>Parameter Name</paper-button></paper-tab>
          <paper-tab><paper-button>Min Value</paper-button></paper-tab>
          <paper-tab><paper-button>Max Value</paper-button></paper-tab>
          <paper-tab><paper-button>Actual Value</paper-button></paper-tab>
          <paper-tab><paper-button>Remarks</paper-button></paper-tab>
        </paper-tabs>
        <template is="dom-repeat" items="{{itemArray}}" as="item">
        <specification-item-crd hidediv="{{hidediv}}" dropflag="{{item.dropflag}}" inputflag="{{item.inputflag}}" itemarr="{{item.droparr}}" measure="{{item.Unit_Measure}}" name="{{item.Quality_Parameter_Name}}" minvalue="{{item.Min_Value}}" maxvalue="{{item.Max_Value}}" ></specification-item-crd>
        </template>
        </div>
        <div class="btncard" hidden$="{{hidebtns}}">
        <paper-button id="submittest" on-click="FnSubmittest"  hidden$="{{hidesubmit}}" readonly="{{submitread}}">Submit Test</paper-button>
        <paper-button id="test" on-click="FnAddtest"  hidden$="{{hidetest}}">Add Test</paper-button>
        </div>
      </div>

    <iron-ajax
      method="post"
      id="specificationitemreadajax"
      url="{{specificationitemreadurl}}"
      params="{{specificationitemreadparam}}"
      handle-as="json"
      content-type="application/json"
      on-response="FnspecificationitemreadResponse">
    </iron-ajax>

    <grn-service id="grnservice"></grn-service>
  </template>
  <script>
  (function() {
    'use strict';
    var qualityarr=[];
    var repeatflag=0;
    Polymer({
      is: 'specification-card',
      ready:function(){
        this.speccardhide=true;
        this.temparr=[];
        var obj={"parametername":"","minval":"","maxval":"","actualval":"","remark":""};
        this.temparr.push(obj);
        this.itemArray=this.temparr;
        this.hidesubmit=true;
        if(localStorage.getItem("curr_sess_retestflag")=="1"){
          this.hidesubmit=true;
          this.hidetest=true;
        }
      },
      FnspecificationitemreadService:function(){
        var obj={"inwardregno":"","checkstatus":"","productid":""};
        obj.inwardregno=sessionStorage.getItem("sess_curr_inwardregno");
        obj.checkstatus=localStorage.getItem("curr_sess_currflowstatus");
        obj.productid=localStorage.getItem("curr_sess_productid");
        this.specificationitemreadparam=obj;
        this.specificationitemreadurl=sessionStorage.getItem("curr_sess_url")+"specificationitemread-service";
        this.$.specificationitemreadajax.generateRequest();
      },
      FnspecificationitemreadResponse:function(e){
        // alert(JSON.stringify(e.detail.response));
        this.finalarr=[];
        this.arr=[];
        this.temp="true";
        this.noparameter=0;
        if(e.detail.response=="no items"){
          // alert('yes');
          this.noparameter=1;
          this.hidediv=true;
          // this.submitread=true;
          //this.specarr=e.detail.response;
        }
        else{
          this.hidediv=false;
          // this.submitread=false;
          this.specarr=e.detail.response;
          for(var i=0;i<this.specarr.length;i++){
            if(this.specarr[i].Quality_Flag=='1'){
              if(this.temp=="true") {
                this.temp=this.specarr[i].Quality_Parameter_Name;
                this.arr.push(this.specarr[i].Min_Value);
              }
              else if(this.temp==this.specarr[i].Quality_Parameter_Name){
                this.arr.push(this.specarr[i].Min_Value);
              }
            }
          }
          for(var i=0;i<this.specarr.length;i++) {
            this.flag = 0;
            if (this.specarr[i].Quality_Flag == '1') {
              //alert(this.specarr[i].Quality_Parameter_ID+'1');
              this.specarr[i].dropflag = false;
              this.specarr[i].inputflag = true;
              this.specarr[i].droparr = this.arr;
              if (repeatflag == 0) {
                this.finalarr.push(this.specarr[i]);
                repeatflag = 1;
              }
            }
            else {
              //alert(this.specarr[i].Quality_Parameter_ID+'0');
              this.specarr[i].dropflag = true;
              this.specarr[i].inputflag = false;
              this.flag = 1;
            }
            if (this.flag == 1) {
              this.finalarr.push(this.specarr[i]);
            }
          }
            this.itemArray = this.finalarr;
          }
      },
      FnSetValue:function(qualityarray){
        qualityarr=qualityarray;
      },
      FnSubmittest:function(){
        if((qualityarr).length==(this.itemArray).length)
        {
          alert('Test submit!');
          this.$.grnservice.updatequalityparameterService(qualityarr);
          this.speccardhide=true;
          this.hidesubmit=true;
          this.hidetest=false;
        }
        else{
          alert('Please enter all the quality parameters!');
        }
      },
      FnAddtest:function(){
        this.speccardhide=false;
        this.hidesubmit=false;
        this.hidetest=true;
        if(this.noparameter==1){
          this.hidesubmit=true;
          this.hidetest=false;
          alert("No Quality Parameter Exists!");
        }
      },
      FnHideSpeccard:function(){
        this.speccardhide=true;
      },
      FnSpecBtnHide:function(){
        this.hidesubmit=true;
        this.hidetest=false;
      }
    });
  })();
  </script>
</dom-module>
