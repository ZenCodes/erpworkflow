
<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="..\..\bower_components/iron-ajax/iron-ajax.html">

<dom-module id="user-service">
  <template>
   <!-- Component which make request to call the url -->
    <iron-ajax      
      id="passwordchangeajax"
      url="{{passwordchangeurl}}"
      params="{{passwordchangeparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="passwordchangeResponse">
    </iron-ajax> 
    <iron-ajax      
      id="resetpasswordajax"
      url="{{resetpasswordurl}}"
      params="{{resetpasswordparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="resetpasswordResponse">
    </iron-ajax> 
    <iron-ajax      
      id="verifymailajax"
      url="{{verifymailurl}}"
      params="{{verifymailparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="verifymailResponse">
    </iron-ajax> 

    <iron-ajax      
      id="userinfoajax"
      url="{{userinfourl}}"
      params="{{userinfoparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="userinfoResponse">
    </iron-ajax> 
    <iron-ajax      
      id="useraccountajax"
      url="{{useraccounturl}}"
      params="{{useraccountparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="useraccountResponse">
    </iron-ajax> 
    <iron-ajax      
      id="userroleajax"
      url="{{userroleurl}}"
      params="{{userroleparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="userroleResponse">
    </iron-ajax> 
    

     <iron-ajax      
      id="readdepartmentajax"
      url="{{readdepartmenturl}}"
      params="{{readdepartmentparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="readdepartmentResponse">
    </iron-ajax> 
    <iron-ajax      
      id="readroleajax"
      url="{{readroleurl}}"
      params="{{readroleparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="readroleResponse">
    </iron-ajax> 

    <iron-ajax      
      id="readusertoapproveajax"
      url="{{readusertoapproveurl}}"
      params="{{readusertoapproveparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="readusertoapproveResponse">
    </iron-ajax> 
    <iron-ajax      
      id="userinforeadajax"
      url="{{userinforeadurl}}"
      params="{{userinforeadparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="userinforeadResponse">
    </iron-ajax> 
     <iron-ajax      
      id="approveuserajax"
      url="{{approveuserurl}}"
      params="{{approveuserparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="approveuserResponse">
    </iron-ajax> 

     <iron-ajax      
      id="updateuserinfoajax"
      url="{{updateinfourl}}"
      params="{{updateinfoparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="updateinfoResponse">
    </iron-ajax> 
    <iron-ajax      
      id="updateuseraccountajax"
      url="{{updateuseraccounturl}}"
      params="{{updateuseraccountparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="updateuseraccountResponse">
    </iron-ajax> 
    <iron-ajax      
      id="updateuserroleajax"
      url="{{updateuserroleurl}}"
      params="{{updateuserroleparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="updateuserroleResponse">
    </iron-ajax> 
    

     <iron-ajax      
      id="accountajax"
      url="{{accounturl}}"
      params="{{accountparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="accountResponse">
    </iron-ajax> 
    <iron-ajax      
      id="roleajax"
      url="{{roleurl}}"
      params="{{roleparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="roleResponse">
    </iron-ajax> 
   
    <iron-ajax      
      id="usersearchajax"
      url="{{usersearchurl}}"
      params="{{usersearchparam}}"
      handle-as="json"
      method="post"
      content-type="application/json"
      on-response="usersearchResponse">
    </iron-ajax> 

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'user-service',
      callreaddepartment:function(){
      this.readdepartmenturl=sessionStorage.getItem("curr_sess_url")+"readdepartment-service";
      // this.readdepartmentparam=obj;
      this.$.readdepartmentajax.generateRequest();
      },
      readdepartmentResponse:function(e){
        var deparray=e.detail.response;
        // alert(JSON.stringify(deparray));
        document.querySelector('userrole-info-card').departmentarr=deparray;
      },
      callreadrole:function(){
      this.readroleurl=sessionStorage.getItem("curr_sess_url")+"readrole-service";
      // this.readroleparam=obj;
      this.$.readroleajax.generateRequest();
      },
      readroleResponse:function(e){
        var rolearray=e.detail.response;
        // alert(JSON.stringify(rolearray));
        document.querySelector('userrole-info-card').rolearr=rolearray;
      },
      callPasswordchangeservice:function(empid,oldpassword,newpassword){
      var obj={"empid":"","oldpassword":"","newpassword":""};
      obj.empid=empid;
      obj.oldpassword=oldpassword;
      obj.newpassword=newpassword;
      this.passwordchangeurl=sessionStorage.getItem("curr_sess_url")+"passwordchange-service";
      this.passwordchangeparam=obj;
      this.$.passwordchangeajax.generateRequest();
      },
      passwordchangeResponse:function(e){
        // alert(JSON.stringify(e.detail.response));
        if(e.detail.response=="succ")
          alert("Password changed successfully!");
        else
          alert("Please try again!");
      },
      callResetpasswordservice:function(empid,newpassword){
      var obj={"empid":"","newpassword":""};
      obj.empid=empid;
      obj.newpassword=newpassword;
      this.resetpasswordurl=sessionStorage.getItem("curr_sess_url")+"resetpassword-service";
      this.resetpasswordparam=obj;
      this.$.resetpasswordajax.generateRequest();
      },
      resetpasswordResponse:function(e){
        if(e.detail.response=="succ")
          alert("Password changed successfully!");
        else
          alert("Please try again!");
      },
      callMailService:function(empid,code){        
      var obj={"empid":"","code":""};
      obj.empid=empid;
      obj.code=code;
      this.verifymailurl=sessionStorage.getItem("curr_sess_url")+"verifymail-service";
      this.verifymailparam=obj;
      this.$.verifymailajax.generateRequest();
      },
      verifymailResponse:function(e){
      alert(JSON.stringify(e.detail.response));
      },
      addemployeeService:function(employeename,dob,sex,age,streetname,location,city,district,state,country,pincode,phoneno,mobileno,emailid){        
      var obj={"employeename":"","dob":"","sex":"","age":"","streetname":"","location":"","city":"","district":"","state":"","country":"","pincode":"","phoneno":"","mobileno":"","emailid":""};
      obj.employeename=employeename;
      obj.dob=dob;
      obj.sex=sex;
      obj.age=age;
      obj.streetname=streetname;
      obj.location=location;
      obj.city=city;
      obj.district=district;
      obj.state=state;
      obj.country=country;
      obj.pincode=pincode;
      obj.phoneno=phoneno;
      obj.mobileno=mobileno;
      obj.emailid=emailid;
      this.userinfourl=sessionStorage.getItem("curr_sess_url")+"userinfo-service";
      this.userinfoparam=obj;
      this.$.userinfoajax.generateRequest();
      },
      userinfoResponse:function(e){
      // alert(JSON.stringify(e.detail.response.val));
      localStorage.setItem("curr_sess_employeeloggedid",e.detail.response.val);
      },
      addpaymentService:function(accountname,accountno,accounttype,bankname,branch,ifsccode){
         var obj1={
            "employeeid":"","accountname":"","accountno":"","accounttype":"","bankname":"",
            "branch":"","ifsccode":""
          };
          obj1.employeeid=localStorage.getItem('curr_sess_employeeloggedid');
          obj1.accountname=accountname;
          obj1.accountno=accountno;
          obj1.accounttype=accounttype;          
          obj1.bankname=bankname;
          obj1.branch=branch;
          obj1.ifsccode=ifsccode;
          
      this.useraccounturl=sessionStorage.getItem("curr_sess_url")+"useraccount-service";
      this.useraccountparam=obj1;
      this.$.useraccountajax.generateRequest();
      },
      useraccountResponse:function(e){
      // alert(JSON.stringify(e.detail.response));
      },
      calluserroleService:function(departmentname,rolename){        
      var obj={"employeeid":"","departmentname":"","rolename":""};
      obj.employeeid=localStorage.getItem('curr_sess_employeeloggedid');
      obj.departmentname=departmentname;
      obj.rolename=rolename;
      this.userroleurl=sessionStorage.getItem("curr_sess_url")+"userrole-service";
      this.userroleparam=obj;
      this.$.userroleajax.generateRequest();
      },
      userroleResponse:function(e){
      // alert(JSON.stringify(e.detail.response));
      alert("Employee Code: "+localStorage.getItem('curr_sess_employeeloggedid'));
      },
      readusertoapproveService:function(){
       this.readusertoapproveurl=sessionStorage.getItem("curr_sess_url")+"readusertoapprove-service";
       this.$.readusertoapproveajax.generateRequest();
      },
      readusertoapproveResponse:function(e){      
       document.querySelector('approveuser-card').itemArray=e.detail.response.itemarr;
      },
 // Function which make request to read the supplier info
    FnUserinforeadService:function(){
      var obj={"employeeid":""};
      obj.employeeid=sessionStorage.getItem("sess_curr_employeeid");      
      this.userinforeadparam=obj;
      this.userinforeadurl=sessionStorage.getItem("curr_sess_url")+"userinforead-service";
      this.$.userinforeadajax.generateRequest();
    },
    userinforeadResponse:function(e){
      var arr=e.detail.response;
      // Binding supplier info to the card in approve supplier page
      document.querySelector("userinfo-read-card").employeename=arr[0].Employee_Name;
      document.querySelector("userinfo-read-card").dob=arr[0].Date_Of_Birth;
      document.querySelector("userinfo-read-card").age=arr[0].Age;
      document.querySelector("userinfo-read-card").sex=arr[0].Sex;      
      document.querySelector("userinfo-read-card").streetname=arr[0].Street_Name;
      document.querySelector("userinfo-read-card").location=arr[0].Location;
      document.querySelector("userinfo-read-card").city=arr[0].City;
      document.querySelector("userinfo-read-card").district=arr[0].District;
      document.querySelector("userinfo-read-card").state=arr[0].State;
      document.querySelector("userinfo-read-card").country=arr[0].Country;
      // document.querySelector("userinfo-read-card").pincode=arr[0].Pincode;
      document.querySelector("userinfo-read-card").phoneno=arr[0].Phone;
      document.querySelector("userinfo-read-card").mobileno=arr[0].Mobile;
      document.querySelector("userinfo-read-card").emailid=arr[0].Email;
      // document.querySelector("supplier-detail-read").faxno=arr[0].Faxno;
      // document.querySelector("supplier-detail-read").website=arr[0].Website;
      // Binding supplier payment info to the card in approve supplier page
      document.querySelector("useraccount-read-card").accountname=arr[0].Account_Name;
      document.querySelector("useraccount-read-card").accountno=arr[0].Account_No;
      document.querySelector("useraccount-read-card").accounttype=arr[0].Account_Type;
      // document.querySelector("useraccount-read-card").paymenttype=arr[0].Payment_Type;
      document.querySelector("useraccount-read-card").bankname=arr[0].Bank_Name;
      document.querySelector("useraccount-read-card").branch=arr[0].Branch;
      document.querySelector("useraccount-read-card").ifsccode=arr[0].IFSC_Code;
      // document.querySelector("useraccount-read-card").micrcode=arr[0].MICR_Code;
      // document.querySelector("useraccount-read-card").swiftcode=arr[0].Swift_Code;
      // document.querySelector("useraccount-read-card").term=arr[0].Payment_Term;
      // Binding supplier tax info to the card in approve supplier page
      document.querySelector("userrole-read-card").departmentname=arr[0].Department_Name;
      document.querySelector("userrole-read-card").rolename=arr[0].Role_ID;
      // document.querySelector("userrole-read-card").panno=arr[0].PAN;
      // document.querySelector("userrole-read-card").tanno=arr[0].TAN;
      // document.querySelector("userrole-read-card").cinno=arr[0].CIN;
      // Binding supplier excise info to the card in approve supplier page
      // document.querySelector("customer-excise-read").regno=arr[0].Reg_No;
      // document.querySelector("customer-excise-read").eccno=arr[0].Ecc_No;
      // document.querySelector("customer-excise-read").range=arr[0].Range;
      // document.querySelector("customer-excise-read").division=arr[0].Division;
      // document.querySelector("customer-excise-read").commission=arr[0].Commission;
      // document.querySelector("customer-excise-read").servicetax=arr[0].Service_Tax;
    },
     // Function which receive all customer who have accepted for approve
    approveuserService:function(status){
        var obj={"employeeid":"","status":""};
        obj.status=status;
        obj.employeeid=sessionStorage.getItem("sess_curr_employeeid");        
        this.approveuserparam=obj;
        this.approveuserurl=sessionStorage.getItem("curr_sess_url")+"approveuser-service";
        this.$.approveuserajax.generateRequest();      
    },
    approveuserResponse:function(e){      
      if(e.detail.response.itemarr=="succ"){  
      alert("Approved Successfully!!")      
        //this.$.dialogpage.FnShowDialog(sessionStorage.getItem("sess_curr_employeename")+" Approved Successfully!!","");
        window.location.href="../elements/indexhome.html";
      }
      else
        alert("Failed to approve the user!!");
    },
    updateemployeeService:function(employeename,dob,sex,age,streetname,location,city,district,state,country,pincode,phoneno,mobileno,emailid){        
      var obj={"employeename":"","dob":"","sex":"","age":"","streetname":"","location":"","city":"","district":"","state":"","country":"","pincode":"","phoneno":"","mobileno":"","emailid":""};
      obj.employeename=employeename;
      obj.dob=dob;
      obj.sex=sex;
      obj.age=age;
      obj.streetname=streetname;
      obj.location=location;
      obj.city=city;
      obj.district=district;
      obj.state=state;
      obj.country=country;
      obj.pincode=pincode;
      obj.phoneno=phoneno;
      obj.mobileno=mobileno;
      obj.emailid=emailid;
      this.updateuserinfourl=sessionStorage.getItem("curr_sess_url")+"updateuserinfo-service";
      this.updateuserinfoparam=obj;
      this.$.updateuserinfoajax.generateRequest();
      },
      updateuserinfoResponse:function(e){
      alert(JSON.stringify(e.detail.response.val));
      // localStorage.setItem("curr_sess_employeeloggedid",e.detail.response.val);
      },
      updatepaymentService:function(accountname,accountno,accounttype,bankname,branch,ifsccode){
         var obj1={
            "employeeid":"","accountname":"","accountno":"","accounttype":"","bankname":"",
            "branch":"","ifsccode":""
          };
          obj1.employeeid=localStorage.getItem('curr_sess_employeeloggedid');
          obj1.accountname=accountname;
          obj1.accountno=accountno;
          obj1.accounttype=accounttype;          
          obj1.bankname=bankname;
          obj1.branch=branch;
          obj1.ifsccode=ifsccode;
          
      this.updateuseraccounturl=sessionStorage.getItem("curr_sess_url")+"updateuseraccount-service";
      this.updateuseraccountparam=obj1;
      this.$.updateuseraccountajax.generateRequest();
      },
      updateuseraccountResponse:function(e){
      alert(JSON.stringify(e.detail.response));
      },
      updateuserroleService:function(departmentname,rolename){        
      var obj={"employeeid":"","departmentname":"","rolename":""};
      obj.employeeid=localStorage.getItem('curr_sess_employeeloggedid');
      obj.departmentname=departmentname;
      obj.rolename=rolename;
      this.updateuserroleurl=sessionStorage.getItem("curr_sess_url")+"updateuserrole-service";
      this.updateuserroleparam=obj;
      this.$.updateuserroleajax.generateRequest();
      },
      updateuserroleResponse:function(e){
      alert(JSON.stringify(e.detail.response));
      // alert("Employee Code: "+localStorage.getItem('curr_sess_employeeloggedid'));
      },
      callAccountService:function(){
         var obj={"employeeid":""};
      obj.employeeid=localStorage.getItem('curr_sess_employeeloggedid');
      // obj.departmentname=departmentname;
      // obj.rolename=rolename;
      this.accounturl=sessionStorage.getItem("curr_sess_url")+"useraccount1-service";
      this.accountparam=obj;
      this.$.accountajax.generateRequest();
      },
      accountResponse:function(e){
        var arr=e.detail.response;
      document.querySelector("useraccount-info-card").accountname=arr[0].Account_Name;
      document.querySelector("useraccount-info-card").accountno=arr[0].Account_No;
      document.querySelector("useraccount-info-card").accounttype=arr[0].Account_Type;
      // document.querySelector("useraccount-read-card").paymenttype=arr[0].Payment_Type;
      document.querySelector("useraccount-info-card").bankname=arr[0].Bank_Name;
      document.querySelector("useraccount-info-card").branch=arr[0].Branch;
      document.querySelector("useraccount-info-card").ifsccode=arr[0].IFSC_Code;
      },
      FnRoleService:function(){
         var obj={"employeeid":""};
      obj.employeeid=localStorage.getItem('curr_sess_employeeloggedid');
      // obj.departmentname=departmentname;
      // obj.rolename=rolename;
      this.roleurl=sessionStorage.getItem("curr_sess_url")+"role-service";
      this.roleparam=obj;
      this.$.roleajax.generateRequest();
      },
      roleResponse:function(e){
        var arr=e.detail.response;
      document.querySelector("userrole-info-card").departmentname=arr[0].Department_Name;
      document.querySelector("userrole-info-card").rolename=arr[0].Role_ID;
      },
      callUsersearchService:function(empid,employeename){
      var obj={"employeename":""};
      obj.employeename=employeename;
      // obj.departmentname=departmentname;
      // obj.rolename=rolename;
      this.usersearchurl=sessionStorage.getItem("curr_sess_url")+"usersearch-service";
      this.usersearchparam=obj;
      this.$.usersearchajax.generateRequest();
      },
      usersearchResponse:function(e){
        var arr=e.detail.response;
        localStorage.setItem('curr_sess_employeeloggedid',arr[0].Employee_ID);
       document.querySelector("user-info-card").employeename=arr[0].Employee_Name;
      document.querySelector("user-info-card").dob=arr[0].Date_Of_Birth;
      document.querySelector("user-info-card").age=arr[0].Age;
      document.querySelector("user-info-card").sex=arr[0].Sex;      
      document.querySelector("user-info-card").streetname=arr[0].Street_Name;
      document.querySelector("user-info-card").location=arr[0].Location;
      document.querySelector("user-info-card").city=arr[0].City;
      document.querySelector("user-info-card").district=arr[0].District;
      document.querySelector("user-info-card").state=arr[0].State;
      document.querySelector("user-info-card").country=arr[0].Country;
      // document.querySelector("userinfo-read-card").pincode=arr[0].Pincode;
      document.querySelector("user-info-card").phoneno=arr[0].Phone;
      document.querySelector("user-info-card").mobileno=arr[0].Mobile;
      document.querySelector("user-info-card").emailid=arr[0].Email;
      }
    });
  })();
  </script>
</dom-module>
